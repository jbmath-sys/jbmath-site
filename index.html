<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>JBMath ‚Ä¢ Videos</title>
  <meta name="description" content="Repositorio de videos del canal JBMath por categor√≠as.">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='70' x='15' font-size='72'%3Eüìê%3C/text%3E%3C/svg%3E">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            base: '#0b1020',
            card: '#111a3a',
            chip: '#1b254d',
            chipOn: '#2741b3',
            text: '#eaf0ff',
            muted: '#9fb0ff',
            accent: '#58e1ff',
          },
          boxShadow: {
            soft: '0 10px 30px rgba(4,10,40,.35)',
            bold: '0 18px 40px rgba(5,12,50,.45)',
          },
          borderRadius: { '2xl': '1.25rem' }
        }
      }
    }
  </script>
  <style>
    body{
      background:
        radial-gradient(1200px 600px at 80% -10%, #1c295f 0%, transparent 60%),
        #0b1020;
      color:#eaf0ff;
    }
    .glass{ backdrop-filter: blur(8px) }
  </style>
</head>
<body class="min-h-screen">
  <header class="sticky top-0 z-20 bg-[rgba(11,16,32,.92)] glass border-b border-white/10">
    <div class="max-w-6xl mx-auto px-4 py-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
      <a href="#/" class="flex items-center gap-3 font-extrabold tracking-tight">
        <div class="w-9 h-9 rounded-xl grid place-items-center bg-gradient-to-br from-sky-400 to-indigo-400 shadow-soft">üìê</div>
        <div>
          <div class="text-lg">JBMath ‚Ä¢ Biblioteca de Videos</div>
          <div class="text-sm text-muted">R√°pido, claro y sin rodeos üòâ</div>
        </div>
      </a>
      <div class="flex items-center gap-2">
        <input id="search" class="w-[60vw] max-w-md rounded-xl border border-white/10 bg-[#0f1734] px-3 py-2 outline-none" placeholder="Buscar por t√≠tulo‚Ä¶"/>
        <a target="_blank" rel="noopener" href="videos.json" class="text-xs px-3 py-2 rounded-lg bg-chip border border-white/10 hover:bg-chipOn">Abrir videos.json</a>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <div id="app"></div>
  </main>

  <footer class="max-w-6xl mx-auto px-4 pb-12 text-muted text-center text-sm">
    Publica en <b>GitHub Pages</b> y comparte tus clases. Hecho con ‚ù§Ô∏è y una pizca de trigonometr√≠a.
  </footer>

  <script type="module">
    import React, { useEffect, useMemo, useState } from 'https://esm.sh/react@18';
    import { createRoot } from 'https://esm.sh/react-dom@18/client';

    // --- utils ---
    const slug = s => s.toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'');
    const chunk = (arr, size) => { const r = []; for(let i=0;i<arr.length;i+=size) r.push(arr.slice(i,i+size)); return r };

    // --- simple hash router ---
    function useHashRoute(){
      const [hash, setHash] = useState(window.location.hash || '#/');
      useEffect(()=>{
        const onHash = () => setHash(window.location.hash || '#/');
        window.addEventListener('hashchange', onHash);
        return () => window.removeEventListener('hashchange', onHash);
      },[]);
      const segs = hash.slice(2).split('/').map(decodeURIComponent);
      return { hash, segs };
    }

    // --- card ---
    function Card({ v, onPlay }){
      return (
        <article className="bg-card/90 rounded-2xl border border-white/10 overflow-hidden shadow-soft hover:shadow-bold transition group">
          <div className="relative aspect-video bg-[#0a1230] overflow-hidden">
            <img loading="lazy" src={\`https://i.ytimg.com/vi/\${v.id}/hqdefault.jpg\`} alt={\`Miniatura de \${v.title}\`} className="w-full h-full object-cover group-hover:scale-[1.02] transition"/>
            <div className="absolute top-2 left-2 bg-black/60 px-3 py-1 rounded-full text-xs">{v.category}</div>
          </div>
          <div className="p-3">
            <div className="font-bold leading-tight">{v.title}</div>
            <div className="text-sm text-muted mt-1">YouTube</div>
            <div className="flex gap-2 mt-3">
              <button onClick={()=>onPlay(v)} className="px-3 py-2 rounded-xl bg-[#0e224a] border border-white/10">‚ñ∂ Reproducir</button>
              <a className="px-3 py-2 rounded-xl border border-white/10" target="_blank" rel="noopener" href={\`https://www.youtube.com/watch?v=\${v.id}\`}>Ver en YouTube</a>
            </div>
          </div>
        </article>
      );
    }

    // --- modal ---
    function Modal({ open, onClose, v }){
      if(!open) return null;
      return (
        <div className="fixed inset-0 bg-black/70 z-50 grid place-items-center p-4" onClick={onClose}>
          <div className="bg-base border border-white/10 rounded-2xl overflow-hidden w-[min(92vw,980px)]" onClick={e=>e.stopPropagation()}>
            <div className="flex items-center justify-between px-4 py-2 border-b border-white/10">
              <div className="font-semibold">{v?.title}</div>
              <button onClick={onClose} className="px-3 py-1 rounded-lg bg-[#17224d] border border-white/10">Cerrar ‚úñ</button>
            </div>
            <div className="aspect-video bg-black">
              {v && (
                <iframe width="100%" height="100%" src={\`https://www.youtube.com/embed/\${v.id}?autoplay=1&rel=0\`} title={v.title} frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
              )}
            </div>
          </div>
        </div>
      );
    }

    // --- pages ---
    function Home({ categories, videosByCat }){
      return (
        <section className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {categories.map(cat => {
            const sample = videosByCat.get(cat)?.slice(0,3) || [];
            return (
              <a href={\`#/categoria/\${encodeURIComponent(slug(cat))}\`} key={cat} className="block bg-card/90 rounded-2xl border border-white/10 overflow-hidden shadow-soft hover:shadow-bold transition">
                <div className="p-4">
                  <div className="text-lg font-bold">{cat}</div>
                  <div className="text-sm text-muted">Ver todos</div>
                </div>
                <div className="grid grid-cols-3 gap-1 p-2">
                  {sample.map(v => (
                    <img key={v.id} alt="" className="rounded-lg aspect-video object-cover" src={\`https://i.ytimg.com/vi/\${v.id}/mqdefault.jpg\`}/>
                  ))}
                </div>
              </a>
            );
          })}
        </section>
      );
    }

    function CategoryPage({ catName, videos, onPlay, pageSize=6 }){
      const [page, setPage] = useState(0);
      useEffect(()=>setPage(0),[catName, videos.length]);
      const pages = chunk(videos, pageSize);
      const data = pages[page] || [];
      return (
        <section className="space-y-4">
          <div className="flex items-center gap-2">
            <a href="#/" className="text-sm text-muted hover:underline">‚Üê Todas las categor√≠as</a>
            <div className="text-sm text-muted">/</div>
            <h1 className="text-xl font-extrabold">{catName}</h1>
          </div>
          <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
            {data.map(v => <Card key={v.id} v={v} onPlay={onPlay}/>)}
          </div>
          <div className="flex items-center justify-center gap-2 pt-2">
            <button disabled={page<=0} onClick={()=>setPage(p=>p-1)} className="px-3 py-1 rounded-lg bg-chip border border-white/10 disabled:opacity-40">Anterior</button>
            <div className="text-sm text-muted">P√°gina {page+1} de {Math.max(1,pages.length)}</div>
            <button disabled={page>=pages.length-1} onClick={()=>setPage(p=>p+1)} className="px-3 py-1 rounded-lg bg-chip border border-white/10 disabled:opacity-40">Siguiente</button>
          </div>
        </section>
      );
    }

    function App(){
      const [all, setAll] = useState([]);
      const [loading, setLoading] = useState(true);
      const [play, setPlay] = useState(null);
      const { segs } = useHashRoute();
      const [term, setTerm] = useState('');

      useEffect(()=>{
        fetch('videos.json?_=' + Date.now()).then(r=>r.json()).then(data=>{
          setAll(data);
          setLoading(false);
        }).catch(err=>{
          console.error(err);
          setLoading(false);
        });
      },[]);

      // derived data
      const filtered = useMemo(()=>{
        const t = term.trim().toLowerCase();
        return t ? all.filter(v=>v.title.toLowerCase().includes(t)) : all;
      },[all, term]);

      const categories = useMemo(()=>[...new Set(filtered.map(v=>v.category))].sort(), [filtered]);
      const mapByCat = useMemo(()=>{
        const m = new Map();
        filtered.forEach(v => {
          const arr = m.get(v.category) || [];
          arr.push(v);
          m.set(v.category, arr);
        });
        return m;
      },[filtered]);

      // route
      const route = segs[0] || '';
      const sub = segs[1] || '';

      useEffect(()=>{
        const input = document.getElementById('search');
        if(input) input.value = term;
      },[term]);

      useEffect(()=>{
        const input = document.getElementById('search');
        const handler = (e)=> setTerm(e.target.value || '');
        input?.addEventListener('input', handler);
        return ()=> input?.removeEventListener('input', handler);
      },[]);

      if(loading) return <div>Cargando‚Ä¶</div>;

      if(route === 'categoria'){
        const catSlug = sub;
        const catName = categories.find(c => slug(c) === catSlug);
        const vids = catName ? mapByCat.get(catName) || [] : [];
        if(!catName) return <div className="text-muted">Categor√≠a no encontrada.</div>;
        return (
          <>
            <CategoryPage catName={catName} videos={vids} onPlay={setPlay}/>
            <Modal open={!!play} onClose={()=>setPlay(null)} v={play}/>
          </>
        );
      }

      // home
      return (
        <>
          <Home categories={categories} videosByCat={mapByCat}/>
          <Modal open={!!play} onClose={()=>setPlay(null)} v={play}/>
        </>
      );
    }

    const root = createRoot(document.getElementById('app'));
    root.render(<App/>);
  </script>
</body>
</html>
